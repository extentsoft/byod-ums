<!DOCTYPE html>
<!--[if IE 8]>			<html class="ie ie8"> <![endif]-->
<!--[if IE 9]>			<html class="ie ie9"> <![endif]-->
<!--[if gt IE 9]><!-->
<html>
<!--<![endif]-->

<!-- Specific Page Data -->

<!-- End of Data -->

<head>
    <meta charset="utf-8" />
    <title>BYOD Excise Department</title>
    <meta name="keywords" content="BYOD, Excise, Excise Department, Bring Your Own Device" />
    <meta name="description" content="BYOD ICT">
    <meta name="author" content="Extentsoft Co.,Ltd.">

    <!-- Set the viewport width to device width for mobile -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <!-- Fav and touch icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="img/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="img/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="img/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="img/ico/apple-touch-icon-57-precomposed.png">
    <link rel="shortcut icon" href="img/ico/favicon.ico">


    <!-- CSS -->

    <!-- Bootstrap & FontAwesome & Entypo CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <!--[if IE 7]><link type="text/css" rel="stylesheet" href="css/font-awesome-ie7.min.css"><![endif]-->
    <link href="css/font-entypo.css" rel="stylesheet" type="text/css">

    <!-- Fonts CSS -->
    <link href="css/fonts.css" rel="stylesheet" type="text/css">

    <!-- Plugin CSS -->
    <link href="plugins/jquery-ui/jquery-ui.custom.min.css" rel="stylesheet" type="text/css">
    <link href="plugins/prettyPhoto-plugin/css/prettyPhoto.css" rel="stylesheet" type="text/css">
    <link href="plugins/isotope/css/isotope.css" rel="stylesheet" type="text/css">
    <link href="plugins/pnotify/css/jquery.pnotify.css" media="screen" rel="stylesheet" type="text/css">
    <link href="plugins/google-code-prettify/prettify.css" rel="stylesheet" type="text/css">


    <link href="plugins/mCustomScrollbar/jquery.mCustomScrollbar.css" rel="stylesheet" type="text/css">
    <link href="plugins/tagsInput/jquery.tagsinput.css" rel="stylesheet" type="text/css">
    <link href="plugins/bootstrap-switch/bootstrap-switch.css" rel="stylesheet" type="text/css">
    <link href="plugins/daterangepicker/daterangepicker-bs3.css" rel="stylesheet" type="text/css">
    <link href="plugins/bootstrap-timepicker/bootstrap-timepicker.min.css" rel="stylesheet" type="text/css">
    <link href="plugins/colorpicker/css/colorpicker.css" rel="stylesheet" type="text/css">

    <!-- Specific CSS -->
    <link href="plugins/fullcalendar/fullcalendar.css" rel="stylesheet" type="text/css">
    <link href="plugins/fullcalendar/fullcalendar.print.css" rel="stylesheet" type="text/css">
    <link href="plugins/introjs/css/introjs.min.css" rel="stylesheet" type="text/css">

    <!-- Theme CSS -->
    <link href="css/theme.min.css" rel="stylesheet" type="text/css">
    <!--[if IE]> <link href="css/ie.css" rel="stylesheet" > <![endif]-->
    <link href="css/chrome.css" rel="stylesheet" type="text/chrome">
    <!-- chrome only css -->


	<link href="plugins/dataTables/css/dataTables.bootstrap.css" rel="stylesheet" type="text/css">

    <!-- Responsive CSS -->
    <link href="css/theme-responsive.min.css" rel="stylesheet" type="text/css">




    <!-- for specific page in style css -->

    <!-- for specific page responsive in style css -->


    <!-- Custom CSS -->
    <link href="custom/custom.css" rel="stylesheet" type="text/css">



    <!-- Head SCRIPTS -->
    <script type="text/javascript" src="js/modernizr.js"></script>
    <script type="text/javascript" src="js/mobile-detect.min.js"></script>
    <script type="text/javascript" src="js/mobile-detect-modernizr.js"></script>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script type="text/javascript" src="js/html5shiv.js"></script>
      <script type="text/javascript" src="js/respond.min.js"></script>
    <![endif]-->

</head>

<body id="dashboard" class="full-layout  nav-right-hide nav-right-start-hide  nav-top-fixed      responsive    clearfix" data-active="dashboard " data-smooth-scrolling="1">
    <div class="vd_body">
        <%- include('../admin/partial/header'); %>

            <!-- Content start -->

            <div class="content">
                <div class="container">
                    <%- include('../admin/partial/menu'); %>


                </div>

                <!-- Middle Content Start -->

                <div class="vd_content-wrapper">
                    <div class="vd_container">
                        <div class="vd_content clearfix">

                            <!-- vd_head-section -->
                            <div class="vd_title-section clearfix">
                                <div class="vd_panel-header">
                                    <h1>ผลสำรวจความพึงพอใจ</h1>
                                    <!-- menu -->									
                                </div>
                            </div>
                            <!-- vd_title-section -->

                            <div class="vd_content-section clearfix">
                                <!-- start row-->

                                <!-- end row -->

                                <div class="row" id="form-basic">
                                    <div class="col-md-12">
                                        <div class="panel widget">
                                            <div class="panel-heading vd_bg-grey">
												<h3 class="panel-title"> <span class="menu-icon"> <i class="fa fa-dot-circle-o"></i> </span> รายชื่อแบบสำรวจ</h3>
                                            </div>
                                            <div class="panel-body table-responsive" id="tab-body">
												<table class="table table-striped" id="data-tables">
													<thead>
														<tr>
															<th>ชื่อแบบสำรวจ</th>
															<th></th>
														</tr>
													</thead>
													<tbody>


													</tbody>
												</table>

											</div>
                                        </div>
                                        <!-- Panel Widget -->
                                    </div>
                                    <!-- col-md-12 -->
                                </div>
                                <!-- row -->


                            </div>
                            <!-- .vd_content-section -->
							<!-- Modal -->
							<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
								<div class="modal-dialog">
									<div class="modal-content">
										<div class="modal-header vd_bg-blue vd_white">
											<button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="fa fa-times"></i></button>
											<h4 class="modal-title" id="myModalLabel">ผลการสำรวจ</h4>
										</div>

										<div class="panel-body background-login">
											<form class="form-horizontal" action="#" role="form" id="form-body">

                                                                                                  
                                            </form>

										</div>
									</div>
									<!-- /.modal-content -->
								</div>
								<!-- /.modal-dialog -->
							</div>
							<!-- /.modal -->
                        </div>
                        <!-- .vd_content -->
                    </div>
                    <!-- .vd_container -->
                </div>
                <!-- .vd_content-wrapper -->

                <!-- Middle Content End -->

            </div>
            <!-- .container -->
    </div>
    <!-- .content -->

    <%- include('../admin/partial/footer'); %>



        </div>

        <!-- .vd_body END  -->
        <a id="back-top " href="# " data-action="backtop " class="vd_back-top visible "> <i class="fa fa-angle-up "> </i> </a>

        <!--
<a class="back-top " href="# " id="back-top "> <i class="icon-chevron-up icon-white "> </i> </a> -->

        <!-- Javascript =============================================== -->
        <!-- Placed at the end of the document so the pages load faster -->
        <script type="text/javascript" src="js/jquery.js"></script>
        <!--[if lt IE 9]>
  <script type="text/javascript" src="js/excanvas.js"></script>
<![endif]-->
        <script type="text/javascript" src="js/bootstrap.min.js"></script>
        <script type="text/javascript" src='plugins/jquery-ui/jquery-ui.custom.min.js'></script>
        <script type="text/javascript" src="plugins/jquery-ui-touch-punch/jquery.ui.touch-punch.min.js"></script>

        <script type="text/javascript" src="js/caroufredsel.js"></script>
        <script type="text/javascript" src="js/plugins.js"></script>

        <script type="text/javascript" src="plugins/breakpoints/breakpoints.js"></script>
        <script type="text/javascript" src="plugins/dataTables/jquery.dataTables.min.js"></script>
        <script type="text/javascript" src="plugins/prettyPhoto-plugin/js/jquery.prettyPhoto.js"></script>

        <script type="text/javascript" src="plugins/mCustomScrollbar/jquery.mCustomScrollbar.concat.min.js"></script>
        <script type="text/javascript" src="plugins/tagsInput/jquery.tagsinput.min.js"></script>
        <script type="text/javascript" src="plugins/bootstrap-switch/bootstrap-switch.min.js"></script>
        <script type="text/javascript" src="plugins/blockUI/jquery.blockUI.js"></script>
        <script type="text/javascript" src="plugins/pnotify/js/jquery.pnotify.min.js"></script>

        <script type="text/javascript" src="js/theme.js"></script>
        <script type="text/javascript" src="custom/custom.js"></script>

        <!-- Specific Page Scripts Put Here -->
        <!-- Flot Chart  -->
        <script type="text/javascript" src="plugins/flot/jquery.flot.min.js"></script>
        <script type="text/javascript" src="plugins/flot/jquery.flot.resize.min.js"></script>
        <script type="text/javascript" src="plugins/flot/jquery.flot.pie.min.js"></script>
        <script type="text/javascript" src="plugins/flot/jquery.flot.categories.min.js"></script>
        <script type="text/javascript" src="plugins/flot/jquery.flot.time.min.js"></script>
        <script type="text/javascript" src="plugins/flot/jquery.flot.animator.min.js"></script>

        <!-- Vector Map -->
        <script type="text/javascript" src="plugins/jvectormap/jquery-jvectormap-1.2.2.min.js"></script>
        <script type="text/javascript" src="plugins/jvectormap/jquery-jvectormap-world-mill-en.js"></script>

        <!-- Calendar -->
        <script type="text/javascript" src='plugins/moment/moment.min.js'></script>
        <script type="text/javascript" src='plugins/jquery-ui/jquery-ui.custom.min.js'></script>
        <script type="text/javascript" src='plugins/fullcalendar/fullcalendar.min.js'></script>

        <!-- Intro JS (Tour) -->
        <script type="text/javascript" src='plugins/introjs/js/intro.min.js'></script>

        <!-- Sky Icons -->
        <script type="text/javascript" src='plugins/skycons/skycons.js'></script>
        


        <!-- Include Date Range Picker -->
        <script type="text/javascript" src="plugins/daterangepicker/daterangepicker.js"></script>
		
		<script type="text/javascript" src="plugins/dataTables/jquery.dataTables.min.js"></script>
        <script type="text/javascript" src="plugins/dataTables/dataTables.bootstrap.js"></script>
        



        <script>
			account_now = $('#email').text().trim();
			var count_ = 0;
			//alert(account_now);
            $(window).load(function() {
                var priv = $("#priv").html().trim().split(",");
                if (priv[1] < 1) {
                    $('#top-menu-3').hide();
                } else {
                    $('#top-menu-3').show();
                }
            });
        </script>
        <!-- Specific Page Scripts END -->

        <script>
            var amount_ = 0;
			var form_ = '';
			var st_ = 0;
			var cust_ = '';
			
			function refresh_table() {
                //alert('refresh');
                $.ajax('http://byod.excise.go.th/api/listcustsat', {
                    type: "get",
                    success: function(json) {
                        //alert(JSON.stringify(json));
                        data_res = JSON.parse(JSON.stringify(json));
                        bindata_table(data_res);
                    }
                });
            }
			
			function addform(data) {
				//alert(JSON.stringify(data));
				document.getElementById('form-body').innerHTML = '';
				amount_ = data.length/6;				
				if(amount_ == 0){
					form_ = 'F0000000';
					var div = document.createElement('div');
						div.className = 'form-group';
						div.innerHTML =

						'<label class="col-sm-4 control-label"></label> \
						<div class="col-sm-7 controls"> \
							<label style="max-width: 100%; word-wrap: break-word">ไม่มีผู้ทำแบบสอบถามนี้</label> \
						</div> \
						';
						document.getElementById('form-body').appendChild(div);
				}
				else {
					form_ = data[0].formid;
				}
				for(i = 0; i < amount_; i++){
					var div = document.createElement('div');
						div.className = 'form-group';
						div.innerHTML =

						'<label class="col-sm-4 control-label">ข้อที่ '+(i+1)+'.</label> \
						<div class="col-sm-7 controls"> \
							<label id="F'+(i+1)+'" style="max-width: 100%; word-wrap: break-word"></label> \
						</div> \
						<div class="form-group"> \
							<label class="col-sm-4 control-label"></label> \
							<div class="col-sm-7 controls"> \
								<div> \
									<label id="C1'+(i+1)+'" style="max-width: 100%; word-wrap: break-word"></label> \
									<span class="help-inline"> มีผู้ตอบจำนวน : ' + data[(i+1)*5].c1 + ' คน</span> \
								</div> \
								<div> \
									<label id="C2'+(i+1)+'" style="max-width: 100%; word-wrap: break-word"></label> \
									<span class="help-inline"> มีผู้ตอบจำนวน : ' + data[(i+1)*5].c2 + ' คน</span> \
								</div> \
								<div> \
									<label id="C3'+(i+1)+'" style="max-width: 100%; word-wrap: break-word"></label> \
									<span class="help-inline"> มีผู้ตอบจำนวน : ' + data[(i+1)*5].c3 + ' คน</span> \
								</div> \
								<div> \
									<label id="C4'+(i+1)+'" style="max-width: 100%; word-wrap: break-word"></label> \
									<span class="help-inline"> มีผู้ตอบจำนวน : ' + data[(i+1)*5].c4 + ' คน</span> \
								</div> \
								<div> \
									<label id="C5'+(i+1)+'" style="max-width: 100%; word-wrap: break-word"></label> \
									<span class="help-inline"> มีผู้ตอบจำนวน : ' + data[(i+1)*5].c5 + ' คน</span> \
								</div> \
							</div> \
						</div> \
						';
					document.getElementById('form-body').appendChild(div);	
				}
				
				for(i = 0; i < data.length; i++){
					document.getElementById(data[i].ftype).innerHTML = data[i].ftext;
				}
			}
			
			function getcust(form_id) {
				$.ajax('http://byod.excise.go.th/api/getcustsat', {
					type: "get",
					data: {formid: form_id},
					success: function(json) {
						data_res = JSON.parse(JSON.stringify(json));
						bindata(data_res);									
					}
				});
			}
			
			function bindata(data_sql) {
                //alert('bind');
                //alert(data_sql);
                data = [];
                for (i = 0; i < data_sql.length; i++) {
                    data_json = {};
                    data_json = {
						ftype: data_sql[1],
						formname: data_sql[2],
						formid: data_sql[3],
						coderef: data_sql[4],
						ftext: data_sql[5],
						c1: data_sql[10],
						c2: data_sql[11],
						c3: data_sql[12],
						c4: data_sql[13],
						c5: data_sql[14],
                    };

                    //alert(JSON.stringify(data_json));
                    data.push(data_json);
                    //alert(JSON.stringify(data));
                    data_sql.splice(0, 15);
                    i = -1;
				}
				addform(data);
			}

			function bindata_table(data_sql) {
                //alert('bind');
                //alert(data_sql);
                data = [];
                total = 0;
                var q = "'";
                for (i = 0; i < data_sql.length; i++) {
                    data_json = {};
					//update_time = new Date(data_sql[3]);
                    //date_str = update_time.getFullYear() + "/" + ((update_time.getUTCMonth()+1) < 10 ? '0' : '') + (update_time.getUTCMonth()+1) + "/" + (update_time.getUTCDate() < 10 ? '0' : '') + update_time.getUTCDate() + ' - ' + (update_time.getUTCHours() < 10 ? '0' : '') + update_time.getUTCHours() + ":" + (update_time.getMinutes() < 10 ? '0' : '') + update_time.getMinutes() + ":" + (update_time.getSeconds() < 10 ? '0' : '') + update_time.getSeconds();

                    $('#data-tables').find('tbody').append('<tr><td>' + data_sql[0] + '</td><td class="menu-action"><a id="' + data_sql[0] + '" data-original-title="edit" data-toggle="modal" data-target="#myModal" data-placement="top" class="btn menu-icon vd_bd-green vd_green" onclick="getcust('+ q + data_sql[1] + q +')" > <i class="fa fa-eye"></i> </a> </td></tr>');
                    data.push(data_json);
                    //alert(JSON.stringify(data));
                    data_sql.splice(0, 2);
                    i = -1;

                }
                //alert(JSON.stringify(data));
                //c1(data);

                $('#data-tables').dataTable();

            }
			
			function submitform() {
				for(i = 0; i < amount_; i++){
					if (document.getElementById('ch1'+(i+1)).checked) {
						r1 = 1;
						r2 = 0;
						r3 = 0;
						r4 = 0;
						r5 = 0;
					} else if (document.getElementById('ch2'+(i+1)).checked) {
						r1 = 0;
						r2 = 1;
						r3 = 0;
						r4 = 0;
						r5 = 0;
					} else if (document.getElementById('ch3'+(i+1)).checked) {
						r1 = 0;
						r2 = 0;
						r3 = 1;
						r4 = 0;
						r5 = 0;
					} else if (document.getElementById('ch4'+(i+1)).checked) {
						r1 = 0;
						r2 = 0;
						r3 = 0;
						r4 = 1;
						r5 = 0;
					} else if (document.getElementById('ch5'+(i+1)).checked) {
						r1 = 0;
						r2 = 0;
						r3 = 0;
						r4 = 0;
						r5 = 1;
					} else{
						r1 = 0;
						r2 = 0;
						r3 = 0;
						r4 = 0;
						r5 = 0;
					}
					
					$.ajax('http://byod.excise.go.th/api/submitcustsat', {
						type: "get",
						data: {
							formid: form_,
							coderef: form_+i,
							res1: r1,
							res2: r2,
							res3: r3,
							res4: r4,
							res5: r5,
							ctext: '',
							acc_now: account_now								
						},
						success: function(json) {	
							//alert(st_);
							if(st_== 0){
								st_ = 1;
								alert('บันทึกแบบสำรวจเรียบร้อย ขอบคุณที่ร่วมแสดงความคิดเห็นครับ');
								clearold();	
							}								
						}
					});					
				}			
            }
			
			function clearold(){
				document.getElementById('form-body').innerHTML = '';
				//document.getElementById('sbm-btn').style.display = "none";
				//window.location = "/";
			}
			
			function list_cust(){
				$.ajax('http://byod.excise.go.th/api/listcustsat', {
                    type: "get",
                    success: function(json) {
                        //alert(JSON.stringify(json));
						var select = document.getElementById("listcustsat");
						data_res = JSON.parse(JSON.stringify(json));
						for (i = 0; i < data_res.length; i++) {							
							var option = document.createElement("option");
							option.text = data_res[i];
							
							option.value = data_res[i+1];
							var select = document.getElementById("listcustsat");
							select.appendChild(option);
							data_res.splice(0, 2);
							i = -1;
						}
                    }
                });
			}
			
			function selectcust(cust_name){
				$("#listcustsat option[value='blank']").remove();
				document.getElementById('form-body').innerHTML = '';
				cust_ = cust_name;
				getcust(cust_);
				
			}
			
			refresh_table();
        </script>

</body>

</html>